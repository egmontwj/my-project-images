// --- Load all four FeatureCollection assets ---
var chicagoCART = ee.FeatureCollection('projects/myearth-465423/assets/ChicagoCART');
var chicagoCNN = ee.FeatureCollection('projects/myearth-465423/assets/ChicagoCNN');
var shenzhenCART = ee.FeatureCollection('projects/myearth-465423/assets/SZ_CART');
var shenzhenCNN = ee.FeatureCollection('projects/myearth-465423/assets/SZ_CNN');

// --- Visualization parameters for Impervious Surfaces ---
var imperviousGradientVis = {
  min: 1001,
  max: 10000,
  palette: ['#00008B', '#00FFFF', '#FFFF00', '#FFA500', '#FF0000']
};

var imperviousBlackVis = {
  min: 0,
  max: 1000,
  palette: ['#000000']
};

// --- Helper function to convert, visualize, and export ---
function exportImperviousTiles(collection, propertyName, description, pathName, region) {
  var empty = ee.Image().byte();
  var numericRaster = empty.paint({ featureCollection: collection, color: propertyName });
  
  var below1000 = numericRaster.updateMask(numericRaster.lte(1000)).visualize(imperviousBlackVis);
  var above1000 = numericRaster.updateMask(numericRaster.gt(1000)).visualize(imperviousGradientVis);
  
  var finalVisualizedImage = ee.ImageCollection([below1000, above1000]).mosaic();

  Export.map.toCloudStorage({
    image: finalVisualizedImage,
    description: description,
    bucket: 'myearth-465423-bucket',
    path: pathName,
    maxZoom: 13,
    region: region.bounds() 
  });
}

// --- Run the function for all four impervious layers ---
exportImperviousTiles(chicagoCART, 'ImpPOI1w', 'Export_Imp_Chicago_CART_Tiles', 'imp_chicago_cart_tiles', chicagoCART.geometry());
exportImperviousTiles(chicagoCNN, 'ImpAdjuste', 'Export_Imp_Chicago_CNN_Tiles', 'imp_chicago_cnn_tiles', chicagoCNN.geometry());
exportImperviousTiles(shenzhenCART, 'ImpPOI10k', 'Export_Imp_Shenzhen_CART_Tiles', 'imp_shenzhen_cart_tiles', shenzhenCART.geometry());
exportImperviousTiles(shenzhenCNN, 'szImpPOI1w', 'Export_Imp_Shenzhen_CNN_Tiles', 'imp_shenzhen_cnn_tiles', shenzhenCNN.geometry());
